pipeline {
	agent { label 'nix' }

	triggers {
		pollSCM('H/1 * * * *')
	}

	stages {
		stage('build') {
			steps {
				script {
					def flakeJson = sh(returnStdout: true, script: 'nix flake show --json')
					def flake = readJSON(text: flakeJson)
					echo "${flake}"
				}
			}
		}
	}
}
