pipeline {
	agent { label 'nix' }

	triggers {
		pollSCM('H/5 * * * *')
	}

	stages {
		stage('build') {
			steps {
				def flakeJson = sh(returnStdout: true, script: 'nix flake show --json')
				def flake = readJSON text: flakeJson
				flake.packages.each { key, value ->
					echo "building ${key}"
				}
			}
		}
	}
}
